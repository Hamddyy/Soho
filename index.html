<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8"> <!-- تحديد نوع الترميز للنصوص -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- ضمان توافق الموقع مع شاشات الهواتف المحمولة -->
    <title>Soho Square</title> <!-- عنوان الصفحة -->
    <style>
        /* تصميم الصفحة */
        body {
            font-family: Arial, sans-serif; /* نوع الخط */
            direction: rtl; /* اتجاه النص من اليمين لليسار */
            text-align: center; /* محاذاة النصوص في المنتصف */
            background-color: #f9f9f9; /* لون الخلفية */
            margin: 0; /* إزالة الهوامش */
            padding: 20px 10px; /* مسافات داخلية للصفحة */
        }

        /* ... باقي الأكواد لتنسيق العناصر المختلفة (القائمة الجانبية، السلة، المنتجات، وغيرها) */
    </style>
</head>
<body>
    <h1>Soho Square</h1> <!-- عنوان رئيسي -->
    <button class="menu-button" onclick="toggleMenu()">☰</button> <!-- زر لفتح القائمة الجانبية -->
    <div class="hamburger-menu" id="hamburgerMenu">
        <ul id="menuList"></ul> <!-- قائمة الفئات للتنقل -->
    </div>
    <div id="categories"></div> <!-- قسم لعرض الفئات -->
    <div class="floating-cart" onclick="toggleCart()"> <!-- زر السلة العائم -->
        <span id="cart-count">0</span> <br> <!-- عدد المنتجات في السلة -->
        <div class="cart-icon">
            <img src="https://raw.githubusercontent.com/Hamddyy/Res/refs/heads/main/images/cart.png" alt="سلة المشتريات"> <!-- أيقونة السلة -->
            <div class="cart-details">
                <span class="cart-total">0 EGP</span> <!-- إجمالي المبلغ -->
            </div>
        </div>
    </div>
    <div id="cart-dropdown" class="cart-dropdown"> <!-- قائمة السلة المنسدلة -->
        <div id="cart-close-btn" class="cart-close-btn" onclick="closeCart()">×</div> <!-- زر إغلاق القائمة -->
        <ul id="cart-list"></ul> <!-- قائمة المنتجات داخل السلة -->
        <div class="total-amount">
            إجمالي المبلغ: <span class="cart-total">0 جنيه</span> <!-- عرض الإجمالي -->
        </div>
        <button id="send-order" onclick="sendOrder()">إرسال الطلب</button> <!-- زر إرسال الطلب -->
    </div>
    <script>
        let allProducts = []; // متغير لتخزين جميع المنتجات

        async function fetchProducts() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/Hamddyy/menu1/refs/heads/main/sohomenu.json'); 
                // جلب المنتجات من ملف JSON عبر الإنترنت
                if (!response.ok) throw new Error('Network response was not ok'); 
                const data = await response.json();
                allProducts = data; // تخزين المنتجات في المتغير
                displayCategories(); // عرض الفئات
                createNavigationMenu(); // إنشاء قائمة التنقل
            } catch (error) {
                console.error('Error fetching the products:', error);
                document.getElementById('categories').innerText = 'حدث خطأ أثناء جلب البيانات.'; // رسالة خطأ
            }
        }

        function toggleMenu() {
            const menu = document.getElementById('hamburgerMenu');
            menu.classList.toggle('open'); // فتح/إغلاق القائمة الجانبية
        }

        function createNavigationMenu() {
            const menuList = document.getElementById('menuList'); // استهداف قائمة التنقل
            const categoryOrder = [/* ترتيب الفئات */];
            categoryOrder.forEach(category => {
                const listItem = document.createElement('li'); // إنشاء عنصر قائمة
                const link = document.createElement('a'); // إنشاء رابط
                link.textContent = category; // اسم الفئة
                link.href = `#${category}`; // الربط بالقسم الخاص بها
                link.onclick = (event) => {
                    event.preventDefault(); 
                    toggleMenu();
                    document.getElementById(category).scrollIntoView({ behavior: 'smooth' }); // التمرير إلى القسم
                };
                listItem.appendChild(link); 
                menuList.appendChild(listItem); 
            });
        }

        function displayCategories() {
            const categoriesContainer = document.getElementById('categories'); 
            categoriesContainer.innerHTML = ''; // تنظيف المحتوى السابق
            const categoryOrder = [/* ترتيب الفئات */];
            const categories = allProducts.reduce((acc, product) => { 
                if (!acc[product.category]) acc[product.category] = []; 
                acc[product.category].push(product); 
                return acc; 
            }, {});
            categoryOrder.forEach(category => {
                if (categories[category]) {
                    const categoryDiv = document.createElement('div'); 
                    categoryDiv.classList.add('category'); 
                    categoryDiv.id = category;
                    categoryDiv.innerHTML = `<h2>${category}</h2>`;
                    const productsGrid = document.createElement('div'); 
                    productsGrid.classList.add('products');
                    categories[category].forEach(product => {
                        const productDiv = document.createElement('div'); 
                        productDiv.classList.add('product'); 
                        productDiv.innerHTML = `
                            <img src="${product.image || 'default-image.jpg'}" alt="${product.name}">
                            <h1>${product.name}</h1>
                            <p>${product.description || 'لا توجد تفاصيل'}</p>
                            <p>Price: ${product.price} EGP</p>
                            <button class="add-to-cart" onclick="addToCart('${product.name}', ${product.price}, '${product.image}')">+ Add</button>
                        `;
                        productsGrid.appendChild(productDiv); 
                    });
                    categoryDiv.appendChild(productsGrid); 
                    categoriesContainer.appendChild(categoryDiv);
                }
            });
        }

        fetchProducts(); // بدء عملية جلب البيانات

        let cart = []; // مصفوفة لتخزين المنتجات في السلة

        function addToCart(name, price, image) { 
            cart.push({ name, price, image }); // إضافة المنتج للسلة
            updateCartDisplay(); 
        }

        function updateCartDisplay() { 
            const cartList = document.getElementById("cart-list"); 
            const cartCount = document.getElementById("cart-count"); 
            const cartTotals = document.querySelectorAll(".cart-total"); 
            cartList.innerHTML = ""; 
            let total = 0;
            cart.forEach((item, index) => {
                const li = document.createElement("li"); 
                li.classList.add("cart-item"); 
                li.innerHTML = `
                    <img src="${item.image}" class="cart-item-image">
                    <span class="cart-item-price">${item.price} EGP</span>
                    <span class="cart-item-name">${item.name}</span>
                    <span class="delete-btn" onclick="removeFromCart(${index})"> × </span>
                `;
                cartList.appendChild(li);
                total += item.price; 
            });

            cartTotals.forEach(element => {
                element.textContent = `${total} EGP`;
            });

            cartCount.textContent = cart.length; 
        }

        function removeFromCart(index) { 
            cart.splice(index, 1); 
            updateCartDisplay(); 
        }

        function toggleCart() { 
            const cartDropdown = document.getElementById("cart-dropdown"); 
            cartDropdown.classList.toggle("show"); 
        }

        function closeCart() { 
            const cartDropdown = document.getElementById("cart-dropdown"); 
            cartDropdown.classList.remove("show"); 
        }

        function sendOrder() { 
            if (!cart.length) {
                alert("السلة فارغة!"); 
                return;
            }
            const message = cart.map((item) => `${item.name}: ${item.price} EGP`).join("\n");
            const total = cart.reduce((sum, item) => sum + item.price, 0); 
            const phone = "201288316889"; 
            const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message + `\ntotal: ${total} EGP`)}`;
            window.location.href = whatsappUrl; 
        }
    </script>
</body>
</html>
